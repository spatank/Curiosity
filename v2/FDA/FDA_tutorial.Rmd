---
title: "FDA Tutorial"
output: html_notebook
---

This notebook follows Jeff Goldsmith and Ana-Maria Staicu's functional data analysis (FDA) tutorial using the diffusion tensor imaging data. The data is comprised of white-matter tracts and profiles of parallel diffusivity along the tracts recorded at many locations. As a result, each tract has an associated continuous profile of parallel diffusivity that can be studied alongside covariates such as results of cognitive tests, indicators of disease status, and demographic variables.

```{r}
library(refund)
data(DTI)
attach(DTI)
names(DTI)
```

```{r}
DTI.complete <- subset(DTI, complete.cases(DTI))
DTI.baseline <- subset(DTI.complete, visit == 1 & case == 1)
tract <- 1:93
n <- length(unique(DTI.baseline$ID))
```



```{r}
matplot(tract, t(DTI.baseline$cca), 
        type='l', lty=1, col="light grey",
        main = "Diffusion Tensor Imaging : CCA",
        xlab="tract", ylab="Fractional anisotropy (FA)")
sel.crv <- sample(1:n, size = 3, replace = FALSE)
matlines(tract, t(DTI.baseline$cca[sel.crv,]), 
         type='l', lty=1, lwd=2, col = rainbow(3))
```


```{r}
library(mgcv)

smooth.curves <- array(0, dim(DTI.baseline$cca))
n <- nrow(DTI.baseline$cca)
for(j in 1:n){
  # j = 1
  fit <- gam(DTI.baseline$cca[j,] ~ s(tract, k = 10, bs = 'cr'), method = "REML")
  # plot(tract, DTI.baseline$cca[j,])
  # lines(tract, fit$fitted)
  smooth.curves[j,] <- fit$fitted
}

matplot(tract, t(DTI.baseline$cca[sel.crv,]), 
         type='l', lty=3, lwd=1, col = rainbow(3))
matlines(tract, t(smooth.curves[sel.crv,]), 
         type='l', lty=1, lwd=1, col = rainbow(3))
```


```{r}
mean.hat <- colMeans(smooth.curves)
matplot(tract, t(DTI.baseline$cca), 
        type='l', lty=1, col="light grey",
        main = "Diffusion Tensor Imaging : CCA",
        xlab="tract", ylab="Fractional anisotropy (FA)")
lines(tract, mean.hat, col='blue', lwd=2)
```

